---
- hosts: default
  become: true
  tasks:
    - copy:
        src: /var/lib/jenkins/workspace/leafer/scripts/
        dest: /tmp

    - name: Compress sql file
      command: bzip2 -f /tmp/leafer.sql

    - name: Restore database
      mysql_db:
        name: my_db
        state: import
        target: /tmp/leafer.sql.bz2

    - name: Stop tomcat7 service
      service:
        name: tomcat7
        state: stoped

    - copy:
      src: /var/lib/jenkins/workspace/leafer/target/leafer.war
      dest: /var/lib/tomcat7/webapps

    - name: Start tomcat7 service
      service:
        name: tomcat7
        state: started
